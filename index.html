-- Tabla de empresas
CREATE TABLE empresas (
  id SERIAL PRIMARY KEY,
  nombre VARCHAR(255) NOT NULL,
  nit VARCHAR(50),
  fecha_creacion TIMESTAMP DEFAULT NOW()
);

-- Tabla de usuarios
CREATE TABLE usuarios (
  id SERIAL PRIMARY KEY,
  empresa_id INTEGER REFERENCES empresas(id),
  nombre VARCHAR(255) NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  telefono VARCHAR(50),
  puesto VARCHAR(255),
  rol VARCHAR(50) DEFAULT 'viewer',
  fecha_creacion TIMESTAMP DEFAULT NOW()
);

-- Tabla de inventarios
CREATE TABLE inventarios (
  id SERIAL PRIMARY KEY,
  empresa_id INTEGER REFERENCES empresas(id),
  codigo VARCHAR(100) NOT NULL,
  nombre VARCHAR(255) NOT NULL,
  cantidad INTEGER NOT NULL,
  costo_unitario DECIMAL(10,2) NOT NULL,
  precio_venta DECIMAL(10,2) NOT NULL,
  valor_mercado DECIMAL(10,2) NOT NULL,
  vnr DECIMAL(10,2) NOT NULL,
  costo_total DECIMAL(10,2) NOT NULL,
  valor_total DECIMAL(10,2) NOT NULL,
  fecha_creacion TIMESTAMP DEFAULT NOW()
);

-- Tabla de correos
CREATE TABLE correos (
  id SERIAL PRIMARY KEY,
  empresa_id INTEGER REFERENCES empresas(id),
  usuario_id INTEGER REFERENCES usuarios(id),
  para VARCHAR(255) NOT NULL,
  asunto VARCHAR(500) NOT NULL,
  mensaje TEXT NOT NULL,
  estado VARCHAR(50) DEFAULT 'enviado',
  metodo VARCHAR(50) DEFAULT 'emailjs',
  fecha_envio TIMESTAMP DEFAULT NOW()
);

-- Tabla de actividad
CREATE TABLE actividad (
  id SERIAL PRIMARY KEY,
  empresa_id INTEGER REFERENCES empresas(id),
  usuario_id INTEGER REFERENCES usuarios(id),
  accion VARCHAR(255) NOT NULL,
  descripcion TEXT,
  fecha_creacion TIMESTAMP DEFAULT NOW()
);

-- √çndices para mejor rendimiento
CREATE INDEX idx_usuarios_empresa ON usuarios(empresa_id);
CREATE INDEX idx_inventarios_empresa ON inventarios(empresa_id);
CREATE INDEX idx_correos_empresa ON correos(empresa_id);
CREATE INDEX idx_actividad_empresa ON actividad(empresa_id);

-- Insertar empresa de ejemplo
INSERT INTO empresas (nombre, nit) VALUES 
('Auditores Guatemala S.A.', '12345678-9');

-- Insertar usuario administrador de ejemplo
INSERT INTO usuarios (empresa_id, nombre, email, password, telefono, puesto, rol) VALUES 
(1, 'Administrador Sistema', 'admin@auditoria.gt', 'admin123', '+502 2234-5678', 'Gerente General', 'admin');
