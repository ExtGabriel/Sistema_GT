<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Auditor√≠a - Guatemala</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 5px;
        }

        .tab-button {
            flex: 1;
            min-width: 120px;
            background: transparent;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .tab-button:hover {
            background: rgba(103, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(103, 126, 234, 0.3);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(103, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(103, 126, 234, 0.3);
        }

        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%); }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: #212529; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .alert {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success { background: rgba(40, 167, 69, 0.1); border-color: #28a745; color: #155724; }
        .alert-error { background: rgba(220, 53, 69, 0.1); border-color: #dc3545; color: #721c24; }
        .alert-info { background: rgba(23, 162, 184, 0.1); border-color: #17a2b8; color: #0c5460; }

        .login-form {
            max-width: 400px;
            margin: 100px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .hidden { display: none !important; }

        .inventory-item {
            background: rgba(248, 249, 250, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .inventory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .stat {
            text-align: center;
            padding: 10px;
            background: rgba(103, 126, 234, 0.1);
            border-radius: 6px;
        }

        .stat strong {
            display: block;
            font-size: 1.2em;
            color: #667eea;
        }

        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(103, 126, 234, 0.05);
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #764ba2;
            background: rgba(103, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .user-item {
            background: rgba(248, 249, 250, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #28a745;
        }

        .user-info { flex: 1; }
        .user-actions { display: flex; gap: 5px; }

        @media (max-width: 768px) {
            .nav-tabs { flex-direction: column; }
            .grid { grid-template-columns: 1fr; }
            .container { padding: 10px; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-form">
        <div class="logo">
            <h2>üá¨üáπ AuditPro</h2>
            <p>Sistema de Auditor√≠a - Guatemala</p>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label>Correo Electr√≥nico</label>
                <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="loginPassword" required>
            </div>
            <div class="form-group">
                <label>Tipo de Usuario</label>
                <select id="userType" required>
                    <option value="">Seleccionar...</option>
                    <option value="admin">Administrador</option>
                    <option value="auditor">Auditor</option>
                    <option value="client">Cliente</option>
                    <option value="developer">Desarrollador</option>
                </select>
            </div>
            <button type="submit" class="btn" style="width: 100%;">Iniciar Sesi√≥n</button>
        </form>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="container">
            <div class="header">
                <h1>üá¨üáπ Sistema de Auditor√≠a</h1>
                <p>Plataforma Integral de Auditor√≠a para Empresas Guatemaltecas</p>
                <div style="text-align: right; margin-top: 15px;">
                    <span id="currentUser" style="margin-right: 20px; font-weight: bold;"></span>
                    <button class="btn btn-danger" onclick="logout()">Cerrar Sesi√≥n</button>
                </div>
            </div>

            <div class="nav-tabs" id="navTabs">
                <button class="tab-button active" onclick="switchTab('correos')">üìß Correos</button>
                <button class="tab-button" onclick="switchTab('inventarios')">üì¶ Inventarios</button>
                <button class="tab-button" onclick="switchTab('usuarios')">üë• Usuarios</button>
                <button class="tab-button" onclick="switchTab('archivos')">üìÅ Archivos</button>
                <button class="tab-button" onclick="switchTab('reportes')">üìä Reportes</button>
            </div>

            <!-- Correos Tab -->
            <div id="correos" class="tab-content active">
                <h2>üìß Centro de Correos con EmailJS</h2>
                
                <!-- Estado de EmailJS -->
                <div class="card" style="background: rgba(40, 167, 69, 0.1); border: 2px solid #28a745;">
                    <h3 id="emailStatus">üéâ EmailJS Configurado y Listo</h3>
                    <p>‚úÖ Public Key: oRv0UzebO2bmLUcBi</p>
                    <p>‚úÖ Service ID: service_b3bbf3j</p>
                    <p>‚úÖ Template ID: template_48fcljb</p>
                    <button class="btn btn-success" onclick="testEmail()">üß™ Enviar Prueba</button>
                    <button class="btn btn-warning" onclick="testLocalEmail()">üìß Prueba Local</button>
                </div>

                <!-- Formulario de Correos -->
                <div class="card">
                    <h3>Enviar Correo</h3>
                    <form id="emailForm">
                        <div class="grid">
                            <div class="form-group">
                                <label>Para (Destinatario)</label>
                                <input type="email" id="emailTo" required>
                            </div>
                            <div class="form-group">
                                <label>Asunto</label>
                                <input type="text" id="emailSubject" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Mensaje</label>
                            <textarea id="emailMessage" rows="6" required></textarea>
                        </div>
                        <button type="submit" class="btn">üìß Enviar Correo</button>
                    </form>
                </div>

                <!-- Plantillas -->
                <div class="card">
                    <h3>üìß Plantillas de Correo</h3>
                    <button class="btn btn-warning" onclick="loadEmailTemplate('audit')">üìã Solicitud de Auditor√≠a</button>
                    <button class="btn btn-warning" onclick="loadEmailTemplate('report')">üìä Reporte de Inventario</button>
                    <button class="btn btn-warning" onclick="loadEmailTemplate('reminder')">‚è∞ Recordatorio</button>
                </div>

                <!-- Historial -->
                <div class="card">
                    <h3>üì¨ Historial de Correos</h3>
                    <div id="emailHistory">
                        <p>No hay correos enviados a√∫n</p>
                    </div>
                </div>
            </div>

            <!-- Inventarios Tab -->
            <div id="inventarios" class="tab-content">
                <h2>üì¶ Gesti√≥n de Inventarios</h2>
                
                <div class="grid">
                    <div class="card">
                        <h3>Agregar Producto al Inventario</h3>
                        <form id="inventoryForm">
                            <div class="form-group">
                                <label>C√≥digo del Producto</label>
                                <input type="text" id="productCode" required>
                            </div>
                            <div class="form-group">
                                <label>Nombre del Producto</label>
                                <input type="text" id="productName" required>
                            </div>
                            <div class="form-group">
                                <label>Cantidad</label>
                                <input type="number" id="productQuantity" required>
                            </div>
                            <div class="form-group">
                                <label>Costo Unitario (Q.)</label>
                                <input type="number" step="0.01" id="unitCost" required>
                            </div>
                            <div class="form-group">
                                <label>Precio de Venta (Q.)</label>
                                <input type="number" step="0.01" id="salePrice" required>
                            </div>
                            <div class="form-group">
                                <label>Valor de Mercado (Q.)</label>
                                <input type="number" step="0.01" id="marketValue" required>
                            </div>
                            <button type="submit" class="btn">Agregar Producto</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Resumen de Inventario</h3>
                        <div class="inventory-stats">
                            <div class="stat">
                                <strong id="totalProducts">2</strong>
                                <span>Productos</span>
                            </div>
                            <div class="stat">
                                <strong id="totalValue">Q. 32,500.00</strong>
                                <span>Valor Total</span>
                            </div>
                            <div class="stat">
                                <strong id="totalVNR">Q. 30,000.00</strong>
                                <span>VNR Total</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Lista de Productos</h3>
                    <div id="inventoryList">
                        <div class="inventory-item">
                            <h4>Caf√© Premium Guatemala (PROD001)</h4>
                            <div class="inventory-stats">
                                <div class="stat">
                                    <strong>500</strong>
                                    <span>Cantidad</span>
                                </div>
                                <div class="stat">
                                    <strong>Q. 25.00</strong>
                                    <span>Costo Unitario</span>
                                </div>
                                <div class="stat">
                                    <strong>Q. 12,500.00</strong>
                                    <span>Costo Total</span>
                                </div>
                                <div class="stat">
                                    <strong>Q. 16,000.00</strong>
                                    <span>VNR</span>
                                </div>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <h4>Textiles Tradicionales (PROD002)</h4>
                            <div class="inventory-stats">
                                <div class="stat">
                                    <strong>200</strong>
                                    <span>Cantidad</span>
                                </div>
                                <div class="stat">
                                    <strong>Q. 45.00</strong>
                                    <span>Costo Unitario</span>
                                </div>
                                <div class="stat">
                                    <strong>Q. 9,000.00</strong>
                                    <span>Costo Total</span>
                                </div>
                                <div class="stat">
                                    <strong>Q. 14,000.00</strong>
                                    <span>VNR</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Usuarios Tab -->
            <div id="usuarios" class="tab-content">
                <h2>üë• Gesti√≥n de Usuarios</h2>
                
                <div class="grid">
                    <div class="card">
                        <h3>Crear Nuevo Usuario</h3>
                        <form id="userForm">
                            <div class="form-group">
                                <label>Nombre Completo</label>
                                <input type="text" id="userName" required>
                            </div>
                            <div class="form-group">
                                <label>Correo Electr√≥nico</label>
                                <input type="email" id="userEmail" required>
                            </div>
                            <div class="form-group">
                                <label>N√∫mero de Tel√©fono</label>
                                <input type="tel" id="userPhone" required>
                            </div>
                            <div class="form-group">
                                <label>Empresa</label>
                                <input type="text" id="userCompany" required>
                            </div>
                            <div class="form-group">
                                <label>Puesto</label>
                                <input type="text" id="userPosition" required>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Usuario</label>
                                <select id="userRole" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="admin">Administrador</option>
                                    <option value="auditor">Auditor</option>
                                    <option value="client">Cliente</option>
                                </select>
                            </div>
                            <button type="submit" class="btn">Crear Usuario</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Usuarios Registrados</h3>
                        <div id="usersList">
                            <div class="user-item">
                                <div class="user-info">
                                    <h4>Mar√≠a Gonz√°lez</h4>
                                    <p><strong>Email:</strong> maria.gonzalez@empresa.gt</p>
                                    <p><strong>Empresa:</strong> Corporaci√≥n Guatemala S.A.</p>
                                    <p><strong>Puesto:</strong> Gerente de Finanzas</p>
                                    <p><strong>Rol:</strong> Administrador</p>
                                </div>
                                <div class="user-actions">
                                    <button class="btn btn-warning">Editar</button>
                                    <button class="btn btn-danger">Eliminar</button>
                                </div>
                            </div>
                            <div class="user-item">
                                <div class="user-info">
                                    <h4>Carlos L√≥pez</h4>
                                    <p><strong>Email:</strong> carlos.lopez@auditores.gt</p>
                                    <p><strong>Empresa:</strong> L√≥pez & Asociados</p>
                                    <p><strong>Puesto:</strong> Auditor Senior</p>
                                    <p><strong>Rol:</strong> Auditor</p>
                                </div>
                                <div class="user-actions">
                                    <button class="btn btn-warning">Editar</button>
                                    <button class="btn btn-danger">Eliminar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Archivos Tab -->
            <div id="archivos" class="tab-content">
                <h2>üìÅ Gesti√≥n de Archivos</h2>
                
                <div class="card">
                    <h3>Subir Archivos</h3>
                    <div class="file-upload" id="fileUploadZone">
                        <div>
                            <h4>üìÅ Arrastra archivos aqu√≠ o haz clic para seleccionar</h4>
                            <p>Formatos soportados: .xlsx, .pdf, .png, .docx (m√°x. 200MB)</p>
                        </div>
                        <input type="file" id="fileInput" multiple accept=".xlsx,.pdf,.png,.docx" style="display: none;">
                    </div>
                </div>

                <div class="card">
                    <h3>Archivos Subidos</h3>
                    <div id="filesList">
                        <div class="user-item">
                            <div class="user-info">
                                <h4>üìÑ Reporte_Inventario_2025.xlsx</h4>
                                <p><strong>Tama√±o:</strong> 1.2 MB</p>
                                <p><strong>Subido por:</strong> Mar√≠a Gonz√°lez</p>
                                <p><strong>Fecha:</strong> 05/09/2025</p>
                            </div>
                            <div class="user-actions">
                                <button class="btn btn-success">Descargar</button>
                                <button class="btn btn-danger">Eliminar</button>
                            </div>
                        </div>
                        <div class="user-item">
                            <div class="user-info">
                                <h4>üìÑ Auditoria_Cafe_2024.pdf</h4>
                                <p><strong>Tama√±o:</strong> 856 KB</p>
                                <p><strong>Subido por:</strong> Carlos L√≥pez</p>
                                <p><strong>Fecha:</strong> 03/09/2025</p>
                            </div>
                            <div class="user-actions">
                                <button class="btn btn-success">Descargar</button>
                                <button class="btn btn-danger">Eliminar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reportes Tab -->
            <div id="reportes" class="tab-content">
                <h2>üìä Reportes y An√°lisis</h2>
                
                <div class="grid">
                    <div class="card">
                        <h3>Generar Reportes</h3>
                        <button class="btn btn-success" onclick="generateReport('inventory')">üìã Reporte de Inventario</button>
                        <button class="btn btn-success" onclick="generateReport('vnr')">üí∞ An√°lisis VNR</button>
                        <button class="btn btn-success" onclick="generateReport('valuation')">üìà Valuaci√≥n de Inventarios</button>
                        <button class="btn btn-success" onclick="generateReport('users')">üë• Reporte de Usuarios</button>
                    </div>

                    <div class="card">
                        <h3>Estad√≠sticas Generales</h3>
                        <div class="inventory-stats">
                            <div class="stat">
                                <strong>2</strong>
                                <span>Total Productos</span>
                            </div>
                            <div class="stat">
                                <strong>2</strong>
                                <span>Usuarios Activos</span>
                            </div>
                            <div class="stat">
                                <strong>2</strong>
                                <span>Archivos</span>
                            </div>
                            <div class="stat">
                                <strong>0</strong>
                                <span>Correos Enviados</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìà Resumen de Auditor√≠a</h3>
                    <p><strong>√öltima actualizaci√≥n:</strong> 05 de Septiembre, 2025</p>
                    <p><strong>Total de empresas auditadas:</strong> 15</p>
                    <p><strong>Valor total auditado:</strong> Q. 2,450,000.00</p>
                    <p><strong>Promedio VNR:</strong> 92.5%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <script>
        // Estado global
        let appState = {
            currentUser: null,
            inventory: [],
            users: [],
            files: [],
            emails: []
        };

        // Configuraci√≥n EmailJS
        const CONFIG = {
            publicKey: 'oRv0UzebO2bmLUcBi',
            serviceId: 'service_b3bbf3j',
            templateId: 'template_48fcljb'
        };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('emailForm').addEventListener('submit', handleEmailSubmit);
            document.getElementById('inventoryForm').addEventListener('submit', handleInventorySubmit);
            document.getElementById('userForm').addEventListener('submit', handleUserSubmit);
            
            setupFileUpload();
            
            // Inicializar EmailJS
            if (typeof emailjs !== 'undefined') {
                emailjs.init(CONFIG.publicKey);
                console.log('‚úÖ EmailJS inicializado');
            }
        });

        // Login
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const userType = document.getElementById('userType').value;

            if (email && userType) {
                appState.currentUser = {
                    email: email,
                    type: userType,
                    name: email.split('@')[0]
                };

                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('currentUser').textContent = `${appState.currentUser.name} (${userType})`;
                
                showAlert('success', '¬°Bienvenido al Sistema de Auditor√≠a!');
            }
        }

        // Logout
        function logout() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        // Cambiar tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Env√≠o de correos
        async function testEmail() {
            const testEmail = prompt('üìß ¬øA qu√© email enviar la prueba?', 'tu-email@gmail.com');
            if (!testEmail) return;

            showAlert('info', 'üîÑ Enviando correo via EmailJS...');

            try {
                const result = await emailjs.send(CONFIG.serviceId, CONFIG.templateId, {
                    to_email: testEmail,
                    subject: 'üß™ Prueba EmailJS - Sistema Guatemala',
                    message: 'Este correo confirma que EmailJS est√° funcionando en el Sistema de Auditor√≠a Guatemala.'
                });

                if (result.status === 200) {
                    showAlert('success', `‚úÖ Correo enviado exitosamente a ${testEmail}`);
                    addToEmailHistory(testEmail, 'üß™ Prueba EmailJS', 'EmailJS');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', '‚ùå Error con EmailJS, usando cliente local...');
                testLocalEmail();
            }
        }

        function testLocalEmail() {
            const testEmail = prompt('üìß Email para cliente local:', 'tu-email@gmail.com');
            if (!testEmail) return;
            
            const subject = encodeURIComponent('üß™ Prueba Sistema Auditor√≠a GT');
            const body = encodeURIComponent('Este es un correo de prueba del Sistema de Auditor√≠a Guatemala usando tu cliente local.');
            
            window.open(`mailto:${testEmail}?subject=${subject}&body=${body}`);
            showAlert('success', 'üìß Cliente de correo abierto');
            addToEmailHistory(testEmail, 'üß™ Prueba Cliente Local', 'Cliente Local');
        }

        async function handleEmailSubmit(e) {
            e.preventDefault();
            
            const to = document.getElementById('emailTo').value;
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;

            try {
                showAlert('info', 'üì§ Enviando correo...');
                
                const result = await emailjs.send(CONFIG.serviceId, CONFIG.templateId, {
                    to_email: to,
                    subject: subject,
                    message: message
                });

                if (result.status === 200) {
                    showAlert('success', `‚úÖ Correo enviado a ${to}`);
                    addToEmailHistory(to, subject, 'EmailJS');
                    e.target.reset();
                }
            } catch (error) {
                showAlert('error', '‚ùå Error con EmailJS, usando cliente local...');
                const mailtoLink = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(message)}`;
                window.open(mailtoLink);
                addToEmailHistory(to, subject, 'Cliente Local');
                e.target.reset();
            }
        }

        function loadEmailTemplate(type) {
            const templates = {
                audit: {
                    subject: 'Solicitud de Auditor√≠a - Guatemala 2025',
                    message: `Estimado/a,

Espero que este mensaje le encuentre bien. Me dirijo a usted para solicitar una auditor√≠a de inventarios.

DETALLES DE LA SOLICITUD:
‚Ä¢ Empresa: [Nombre de la empresa]
‚Ä¢ Tipo de auditor√≠a: Inventarios y VNR
‚Ä¢ Per√≠odo: 2025
‚Ä¢ Ubicaci√≥n: Guatemala

SERVICIOS REQUERIDOS:
‚úì Verificaci√≥n f√≠sica de inventarios
‚úì C√°lculo de Valor Neto de Realizaci√≥n (VNR)
‚úì Valuaci√≥n seg√∫n normas guatemaltecas
‚úì Informe certificado

Agradecemos su pronta respuesta.

Saludos cordiales,
Sistema de Auditor√≠a Guatemala üá¨üáπ`
                },
                report: {
                    subject: 'Reporte de Inventario - ' + new Date().toLocaleDateString(),
                    message: `Estimado/a,

Adjunto el reporte actualizado de inventario.

RESUMEN EJECUTIVO:
üì¶ Total de productos: 2
üí∞ Valor total: Q. 32,500.00
üìà VNR total: Q. 30,000.00

PRODUCTOS PRINCIPALES:
‚Ä¢ Caf√© Premium Guatemala - Q. 16,000.00 VNR
‚Ä¢ Textiles Tradicionales - Q. 14,000.00 VNR

Saludos,
Departamento de Auditor√≠a Guatemala üá¨üáπ`
                },
                reminder: {
                    subject: 'Recordatorio - Auditor√≠a Programada',
                    message: `Estimado/a,

Recordatorio sobre la auditor√≠a programada:

DETALLES:
üìÖ Fecha: [Completar]
üïê Hora: [Completar]
üìç Ubicaci√≥n: [Completar]

DOCUMENTOS REQUERIDOS:
‚úì Inventario f√≠sico
‚úì Facturas de compra
‚úì Registros contables

Confirme su asistencia.

Saludos,
Sistema de Auditor√≠a Guatemala üá¨üáπ`
                }
            };

            const template = templates[type];
            document.getElementById('emailSubject').value = template.subject;
            document.getElementById('emailMessage').value = template.message;
            showAlert('info', `üìß Plantilla "${type}" cargada`);
        }

        function addToEmailHistory(to, subject, method) {
            const emailItem = {
                to: to,
                subject: subject,
                method: method,
                date: new Date().toLocaleString()
            };
            
            appState.emails.push(emailItem);
            updateEmailHistory();
        }

        function updateEmailHistory() {
            const historyDiv = document.getElementById('emailHistory');
            let html = '';

            if (appState.emails.length === 0) {
                html = '<p>No hay correos enviados a√∫n</p>';
            } else {
                appState.emails.forEach(email => {
                    html += `
                        <div class="user-item">
                            <div class="user-info">
                                <h4>üìß ${email.subject}</h4>
                                <p><strong>Para:</strong> ${email.to}</p>
                                <p><strong>Fecha:</strong> ${email.date}</p>
                                <p><strong>M√©todo:</strong> ${email.method}</p>
                            </div>
                        </div>
                    `;
                });
            }
            
            historyDiv.innerHTML = html;
        }

        // Gesti√≥n de inventarios
        function handleInventorySubmit(e) {
            e.preventDefault();
            
            const product = {
                id: Date.now(),
                code: document.getElementById('productCode').value,
                name: document.getElementById('productName').value,
                quantity: parseInt(document.getElementById('productQuantity').value),
                unitCost: parseFloat(document.getElementById('unitCost').value),
                salePrice: parseFloat(document.getElementById('salePrice').value),
                marketValue: parseFloat(document.getElementById('marketValue').value)
            };

            // Calcular VNR
            product.vnr = Math.min(product.salePrice, product.marketValue) * product.quantity;
            product.totalCost = product.unitCost * product.quantity;
            product.totalValue = product.salePrice * product.quantity;

            appState.inventory.push(product);
            updateInventoryDisplay();
            e.target.reset();
            showAlert('success', 'Producto agregado al inventario');
        }

        function updateInventoryDisplay() {
            const inventoryList = document.getElementById('inventoryList');
            let html = '';

            appState.inventory.forEach(product => {
                html += `
                    <div class="inventory-item">
                        <h4>${product.name} (${product.code})</h4>
                        <div class="inventory-stats">
                            <div class="stat">
                                <strong>${product.quantity}</strong>
                                <span>Cantidad</span>
                            </div>
                            <div class="stat">
                                <strong>Q. ${product.unitCost.toFixed(2)}</strong>
                                <span>Costo Unitario</span>
                            </div>
                            <div class="stat">
                                <strong>Q. ${product.totalCost.toFixed(2)}</strong>
                                <span>Costo Total</span>
                            </div>
                            <div class="stat">
                                <strong>Q. ${product.vnr.toFixed(2)}</strong>
                                <span>VNR</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <button class="btn btn-warning" onclick="editProduct(${product.id})">Editar</button>
                            <button class="btn btn-danger" onclick="deleteProduct(${product.id})">Eliminar</button>
                        </div>
                    </div>
                `;
            });

            if (html) {
                inventoryList.innerHTML += html;
            }

            updateInventorySummary();
        }

        function updateInventorySummary() {
            const totalProducts = appState.inventory.length + 2; // +2 por productos ejemplo
            const totalValue = appState.inventory.reduce((sum, p) => sum + p.totalValue, 32500);
            const totalVNR = appState.inventory.reduce((sum, p) => sum + p.vnr, 30000);

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalValue').textContent = `Q. ${totalValue.toFixed(2)}`;
            document.getElementById('totalVNR').textContent = `Q. ${totalVNR.toFixed(2)}`;
        }

        // Gesti√≥n de usuarios
        function handleUserSubmit(e) {
            e.preventDefault();
            
            const user = {
                id: Date.now(),
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                phone: document.getElementById('userPhone').value,
                company: document.getElementById('userCompany').value,
                position: document.getElementById('userPosition').value,
                role: document.getElementById('userRole').value,
                createdDate: new Date().toLocaleDateString()
            };

            appState.users.push(user);
            updateUsersDisplay();
            e.target.reset();
            showAlert('success', 'Usuario creado exitosamente');
        }

        function updateUsersDisplay() {
            const usersList = document.getElementById('usersList');
            let html = `
                <div class="user-item">
                    <div class="user-info">
                        <h4>Mar√≠a Gonz√°lez</h4>
                        <p><strong>Email:</strong> maria.gonzalez@empresa.gt</p>
                        <p><strong>Empresa:</strong> Corporaci√≥n Guatemala S.A.</p>
                        <p><strong>Puesto:</strong> Gerente de Finanzas</p>
                        <p><strong>Rol:</strong> Administrador</p>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-warning">Editar</button>
                        <button class="btn btn-danger">Eliminar</button>
                    </div>
                </div>
                <div class="user-item">
                    <div class="user-info">
                        <h4>Carlos L√≥pez</h4>
                        <p><strong>Email:</strong> carlos.lopez@auditores.gt</p>
                        <p><strong>Empresa:</strong> L√≥pez & Asociados</p>
                        <p><strong>Puesto:</strong> Auditor Senior</p>
                        <p><strong>Rol:</strong> Auditor</p>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-warning">Editar</button>
                        <button class="btn btn-danger">Eliminar</button>
                    </div>
                </div>
            `;

            appState.users.forEach(user => {
                html += `
                    <div class="user-item">
                        <div class="user-info">
                            <h4>${user.name}</h4>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Empresa:</strong> ${user.company}</p>
                            <p><strong>Puesto:</strong> ${user.position}</p>
                            <p><strong>Rol:</strong> ${user.role}</p>
                        </div>
                        <div class="user-actions">
                            <button class="btn btn-warning">Editar</button>
                            <button class="btn btn-danger" onclick="deleteUser(${user.id})">Eliminar</button>
                        </div>
                    </div>
                `;
            });

            usersList.innerHTML = html;
        }

        function deleteUser(id) {
            appState.users = appState.users.filter(u => u.id !== id);
            updateUsersDisplay();
            showAlert('success', 'Usuario eliminado');
        }

        // Gesti√≥n de archivos
        function setupFileUpload() {
            const fileUploadZone = document.getElementById('fileUploadZone');
            const fileInput = document.getElementById('fileInput');

            fileUploadZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                if (file.size > 200 * 1024 * 1024) {
                    showAlert('error', `Archivo muy grande: ${file.name}`);
                    return;
                }
                
                uploadFile(file);
            });
        }

        function uploadFile(file) {
            // Simular subida
            showAlert('info', `Subiendo: ${file.name}...`);
            
            setTimeout(() => {
                const fileObj = {
                    id: Date.now(),
                    name: file.name,
                    size: file.size,
                    uploadDate: new Date().toLocaleDateString(),
                    uploader: appState.currentUser?.name || 'Usuario'
                };
                
                appState.files.push(fileObj);
                updateFilesDisplay();
                showAlert('success', `Archivo subido: ${file.name}`);
            }, 2000);
        }

        function updateFilesDisplay() {
            const filesList = document.getElementById('filesList');
            let html = `
                <div class="user-item">
                    <div class="user-info">
                        <h4>üìÑ Reporte_Inventario_2025.xlsx</h4>
                        <p><strong>Tama√±o:</strong> 1.2 MB</p>
                        <p><strong>Subido por:</strong> Mar√≠a Gonz√°lez</p>
                        <p><strong>Fecha:</strong> 05/09/2025</p>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-success">Descargar</button>
                        <button class="btn btn-danger">Eliminar</button>
                    </div>
                </div>
                <div class="user-item">
                    <div class="user-info">
                        <h4>üìÑ Auditoria_Cafe_2024.pdf</h4>
                        <p><strong>Tama√±o:</strong> 856 KB</p>
                        <p><strong>Subido por:</strong> Carlos L√≥pez</p>
                        <p><strong>Fecha:</strong> 03/09/2025</p>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-success">Descargar</button>
                        <button class="btn btn-danger">Eliminar</button>
                    </div>
                </div>
            `;

            appState.files.forEach(file => {
                const fileSizeKB = (file.size / 1024).toFixed(2);
                html += `
                    <div class="user-item">
                        <div class="user-info">
                            <h4>üìÑ ${file.name}</h4>
                            <p><strong>Tama√±o:</strong> ${fileSizeKB} KB</p>
                            <p><strong>Subido por:</strong> ${file.uploader}</p>
                            <p><strong>Fecha:</strong> ${file.uploadDate}</p>
                        </div>
                        <div class="user-actions">
                            <button class="btn btn-success">Descargar</button>
                            <button class="btn btn-danger" onclick="deleteFile(${file.id})">Eliminar</button>
                        </div>
                    </div>
                `;
            });

            filesList.innerHTML = html;
        }

        function deleteFile(id) {
            appState.files = appState.files.filter(f => f.id !== id);
            updateFilesDisplay();
            showAlert('success', 'Archivo eliminado');
        }

        // Generaci√≥n de reportes
        function generateReport(type) {
            const reports = {
                inventory: () => {
                    const report = `REPORTE DE INVENTARIO - ${new Date().toLocaleDateString()}

Total de productos: ${appState.inventory.length + 2}
Valor total: Q. ${(appState.inventory.reduce((sum, p) => sum + p.totalValue, 32500)).toFixed(2)}
VNR total: Q. ${(appState.inventory.reduce((sum, p) => sum + p.vnr, 30000)).toFixed(2)}

PRODUCTOS:
1. Caf√© Premium Guatemala - VNR: Q. 16,000.00
2. Textiles Tradicionales - VNR: Q. 14,000.00
${appState.inventory.map((p, i) => `${i + 3}. ${p.name} - VNR: Q. ${p.vnr.toFixed(2)}`).join('\n')}`;
                    
                    downloadReport(report, 'reporte_inventario.txt');
                },
                vnr: () => {
                    const report = `AN√ÅLISIS VNR - ${new Date().toLocaleDateString()}

El VNR se calcula como el menor valor entre precio de venta y valor de mercado.

AN√ÅLISIS:
‚Ä¢ Caf√© Premium: VNR Q. 32.00/unidad
‚Ä¢ Textiles: VNR Q. 70.00/unidad
‚Ä¢ Promedio VNR: 92.5% del costo

Total VNR del sistema: Q. 30,000.00`;
                    
                    downloadReport(report, 'analisis_vnr.txt');
                },
                valuation: () => {
                    const report = `VALUACI√ìN DE INVENTARIOS - ${new Date().toLocaleDateString()}

M√©todo utilizado: Costo vs VNR (el menor)
Cumple normas contables guatemaltecas.

VALUACI√ìN:
‚Ä¢ Valuaci√≥n total: Q. 30,000.00
‚Ä¢ Diferencia con costo: Q. 2,500.00
‚Ä¢ Porcentaje de ajuste: 7.7%

Los inventarios se val√∫an al menor entre costo y VNR seg√∫n principios contables.`;
                    
                    downloadReport(report, 'valuacion_inventarios.txt');
                },
                users: () => {
                    const report = `REPORTE DE USUARIOS - ${new Date().toLocaleDateString()}

Total de usuarios: ${appState.users.length + 2}

USUARIOS REGISTRADOS:
1. Mar√≠a Gonz√°lez - Administrador - Corporaci√≥n Guatemala S.A.
2. Carlos L√≥pez - Auditor - L√≥pez & Asociados
${appState.users.map((u, i) => `${i + 3}. ${u.name} - ${u.role} - ${u.company}`).join('\n')}`;
                    
                    downloadReport(report, 'reporte_usuarios.txt');
                }
            };

            if (reports[type]) {
                reports[type]();
                showAlert('success', 'Reporte generado y descargado');
            }
        }

        function downloadReport(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Mostrar alertas
        function showAlert(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                activeTab.insertBefore(alert, activeTab.firstChild);
                
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 5000);
            }
        }

        console.log('‚úÖ Sistema de Auditor√≠a Guatemala - Versi√≥n Completa');
    </script>
</body>
</html>
